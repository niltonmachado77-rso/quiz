                </textarea>
                </div>
    <!-- Bot√£o Flutuante para Download do App -->
    <div class="floating-download" onclick="downloadApp()" title="Instalar App">
        üì±
    </div>

    <!-- Vers√£o do Sistema -->
    <div class="version-info">
        v2.0.0 | Quiz LP
    </div>

    <script>
        // ==========================================
        // CONFIGURA√á√ïES E DADOS GLOBAIS
        // ==========================================
        
        let currentUser = null;
        let currentQuiz = null;
        let currentQuestion = 0;
        let questionStartTime = 0;
        let timerInterval = null;
        let attempts = 0;
        let score = 0;
        let selectedDifficulty = null;
        let selectedSubject = null;
        let totalTime = 0;
        let correctAnswers = 0;

        // Base de dados de quest√µes (expandida)
        let questionsDatabase = {
            ortografia: {
                '6ano': [
                    {
                        pergunta: "Qual √© a grafia correta da palavra?",
                        respostas: ["exce√ß√£o", "excess√£o", "exse√ß√£o", "exces√£o", "exe√ß√£o", "ece√ß√£o"],
                        correta: 0,
                        dificuldade: "medium"
                    },
                    {
                        pergunta: "Complete: Ele _____ ontem √† escola.",
                        respostas: ["veio", "veo", "veiu", "veiou", "vio", "viu"],
                        correta: 0,
                        dificuldade: "easy"
                    },
                    {
                        pergunta: "Qual palavra est√° escrita corretamente?",
                        respostas: ["an√°lise", "analise", "an√°lizi", "analize", "analiz√™", "analis√™"],
                        correta: 0,
                        dificuldade: "hard"
                    }
                ],
                '7ano': [
                    {
                        pergunta: "Qual √© a forma correta?",
                        respostas: ["privil√©gio", "previl√©gio", "privil√™gio", "previlegio", "privilegio", "previl√™gio"],
                        correta: 0,
                        dificuldade: "medium"
                    }
                ]
            },
            morfologia: {
                '6ano': [
                    {
                        pergunta: "Qual √© o plural correto de 'l√°pis'?",
                        respostas: ["l√°pis", "lapis", "l√°pises", "l√°pisses", "lapiss", "lapizes"],
                        correta: 0,
                        dificuldade: "easy"
                    },
                    {
                        pergunta: "Qual √© o feminino de 'galo'?",
                        respostas: ["galinha", "gala", "galia", "galina", "galona", "galesa"],
                        correta: 0,
                        dificuldade: "easy"
                    }
                ]
            },
            redacao: {
                '6ano': [
                    {
                        pergunta: "Qual conectivo indica oposi√ß√£o?",
                        respostas: ["mas", "e", "ent√£o", "porque", "quando", "onde"],
                        correta: 0,
                        dificuldade: "medium"
                    }
                ]
            }
        };

        let userStats = JSON.parse(localStorage.getItem('userStats') || '{}');
        let lastUploadDate = localStorage.getItem('lastUploadDate');

        // ==========================================
        // FUN√á√ïES DE AUTENTICA√á√ÉO
        // ==========================================
        
        function loginStudent() {
            const name = document.getElementById('studentName').value.trim();
            const series = document.getElementById('studentSeries').value;
            
            if (!name || !series) {
                showAlert('‚ö†Ô∏è Por favor, preencha todos os campos.', 'warning');
                return;
            }

            if (name.length < 2) {
                showAlert('‚ö†Ô∏è Nome deve ter pelo menos 2 caracteres.', 'warning');
                return;
            }

            currentUser = {
                name: name,
                series: series,
                type: 'student',
                loginTime: new Date().toISOString()
            };

            document.getElementById('welcomeStudent').innerHTML = `üëã Ol√°, <strong>${name}</strong>!`;
            
            // Ocultar estat√≠sticas do login quando aluno logado
            document.getElementById('systemStatsLogin').style.display = 'none';
            
            checkForNewQuizzes();
            showScreen('studentScreen');
            loadUserScore();
            
            showAlert(`üéâ Bem-vindo, ${name}! Escolha uma mat√©ria para come√ßar.`, 'success');
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== 'admin123') {
                showAlert('‚ùå Senha incorreta. Tente: admin123', 'danger');
                return;
            }

            currentUser = {
                name: 'Admin',
                type: 'admin',
                loginTime: new Date().toISOString()
            };

            // Ocultar estat√≠sticas do login quando admin logado
            document.getElementById('systemStatsLogin').style.display = 'none';

            showScreen('adminScreen');
            updateStats();
            showAlert('üë®‚Äçüíº Login administrativo realizado com sucesso!', 'success');
        }

        function logout() {
            if (timerInterval) clearInterval(timerInterval);
            
            currentUser = null;
            selectedDifficulty = null;
            selectedSubject = null;
            
            // Mostrar estat√≠sticas novamente no login
            document.getElementById('systemStatsLogin').style.display = 'block';
            updateLoginStats();
            
            showScreen('loginScreen');
            resetForm();
            
            showAlert('üëã Logout realizado com sucesso!', 'info');
        }

        // Fun√ß√£o para atualizar estat√≠sticas na tela de login
        function updateLoginStats() {
            const totalUsers = Object.keys(userStats).length;
            const totalQuizzes = Object.values(userStats).reduce((sum, user) => sum + user.quizCount, 0);
            const totalQuestions = Object.values(questionsDatabase).reduce((sum, materia) => {
                return sum + Object.values(materia).reduce((sum2, serie) => sum2 + serie.length, 0);
            }, 0);
            const totalSubjects = Object.keys(questionsDatabase).length;

            document.getElementById('totalUsersLogin').textContent = totalUsers;
            document.getElementById('totalQuizzesLogin').textContent = totalQuizzes;
            document.getElementById('totalQuestionsLogin').textContent = totalQuestions;
            document.getElementById('totalSubjectsLogin').textContent = totalSubjects;
        }

        // Fun√ß√µes p√∫blicas para visitantes
        function showDetailedStatsPublic() {
            const stats = Object.values(userStats);
            const avgScore = stats.length > 0 ? Math.round(stats.reduce((sum, user) => sum + user.totalScore, 0) / stats.length) : 0;
            const topScore = stats.length > 0 ? Math.max(...stats.map(user => user.bestScore)) : 0;

            alert(`üìà RELAT√ìRIO P√öBLICO DO SISTEMA QUIZ LP

üéì DESEMPENHO DOS ESTUDANTES:
   ‚Ä¢ Total de estudantes: ${stats.length}
   ‚Ä¢ Pontua√ß√£o m√©dia: ${avgScore} pontos
   ‚Ä¢ Melhor pontua√ß√£o: ${topScore} pontos
   ‚Ä¢ Total de quizzes realizados: ${stats.reduce((sum, user) => sum + user.quizCount, 0)}

üìö CONTE√öDO DISPON√çVEL:
   ‚Ä¢ Mat√©rias ativas: ${Object.keys(questionsDatabase).length}
   ‚Ä¢ Total de quest√µes: ${Object.values(questionsDatabase).reduce((sum, materia) => sum + Object.values(materia).reduce((sum2, serie) => sum2 + serie.length, 0), 0)}

üéØ DISTRIBUI√á√ÉO POR MAT√âRIA:
${Object.entries(questionsDatabase).map(([materia, series]) => {
    const count = Object.values(series).reduce((sum, arr) => sum + arr.length, 0);
    return `   ‚Ä¢ ${materia.charAt(0).toUpperCase() + materia.slice(1)}: ${count} quest√µes`;
}).join('\n')}

üìä S√âRIES ATENDIDAS:
   ‚Ä¢ 5¬∫ ao 9¬∫ ano do Ensino Fundamental
   ‚Ä¢ Conte√∫do adaptado por s√©rie
   ‚Ä¢ Dificuldades: F√°cil, M√©dio e Dif√≠cil

üéÆ COMO PARTICIPAR:
   ‚Ä¢ Fa√ßa seu cadastro como estudante
   ‚Ä¢ Escolha sua mat√©ria preferida
   ‚Ä¢ Teste seus conhecimentos
   ‚Ä¢ Compete no ranking!

üí° Sistema desenvolvido para educa√ß√£o de qualidade!`);
        }

        function exportPublicData() {
            const publicData = {
                timestamp: new Date().toISOString(),
                version: '2.0.0',
                systemInfo: {
                    totalUsers: Object.keys(userStats).length,
                    totalQuestions: Object.values(questionsDatabase).reduce((sum, materia) => {
                        return sum + Object.values(materia).reduce((sum2, serie) => sum2 + serie.length, 0);
                    }, 0),
                    totalQuizzes: Object.values(userStats).reduce((sum, user) => sum + user.quizCount, 0),
                    subjects: Object.keys(questionsDatabase),
                    series: ['5ano', '6ano', '7ano', '8ano', '9ano']
                },
                publicStats: {
                    averageScore: Object.values(userStats).length > 0 ? 
                        Math.round(Object.values(userStats).reduce((sum, user) => sum + user.totalScore, 0) / Object.values(userStats).length) : 0,
                    topScore: Object.values(userStats).length > 0 ? 
                        Math.max(...Object.values(userStats).map(user => user.bestScore)) : 0
                }
            };

            const jsonString = JSON.stringify(publicData, null, 2);
            downloadFile(jsonString, `quiz_lp_info_publica_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showAlert('üìä Informa√ß√µes p√∫blicas exportadas!', 'success');
        }

        function resetForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentSeries').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('subjectSelect').value = '';
            document.querySelectorAll('.difficulty-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('startQuizBtn').disabled = true;
        }

        // ==========================================
        // FUN√á√ïES DE NAVEGA√á√ÉO E UI
        // ==========================================
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showAlert(message, type = 'info') {
            const colors = {
                success: '#d4edda',
                danger: '#f8d7da',
                warning: '#fff3cd',
                info: '#d1ecf1'
            };

            const alert = document.createElement('div');
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: #333;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                animation: slideInRight 0.5s ease;
            `;
            alert.innerHTML = message;

            document.body.appendChild(alert);

            setTimeout(() => {
                alert.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => document.body.removeChild(alert), 500);
            }, 4000);
        }

        // ==========================================
        // FUN√á√ïES DO QUIZ
        // ==========================================
        
        function selectDifficulty(difficulty) {
            selectedDifficulty = difficulty;
            document.querySelectorAll('.difficulty-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.difficulty-${difficulty}`).classList.add('selected');
            
            updateStartButton();
        }

        function updateStartButton() {
            const subject = document.getElementById('subjectSelect').value;
            const btn = document.getElementById('startQuizBtn');
            
            if (subject && selectedDifficulty) {
                btn.disabled = false;
                selectedSubject = subject;
                btn.style.transform = 'scale(1.05)';
                btn.innerHTML = 'üöÄ Come√ßar Agora!';
            } else {
                btn.disabled = true;
                btn.style.transform = 'scale(1)';
                btn.innerHTML = 'üöÄ Iniciar Quiz';
            }
        }

        function startQuiz() {
            if (!selectedSubject || !selectedDifficulty) {
                showAlert('‚ö†Ô∏è Selecione uma mat√©ria e dificuldade.', 'warning');
                return;
            }

            const questions = getQuestionsForUser();
            
            if (!questions || questions.length === 0) {
                showAlert('üìö N√£o h√° quest√µes dispon√≠veis para esta combina√ß√£o. Tente outra mat√©ria!', 'warning');
                return;
            }

            currentQuiz = {
                questions: shuffleArray([...questions]).slice(0, 10),
                difficulty: selectedDifficulty,
                subject: selectedSubject,
                startTime: Date.now()
            };

            currentQuestion = 0;
            score = 0;
            totalTime = 0;
            correctAnswers = 0;
            
            document.getElementById('quizScore').textContent = score;
            showScreen('quizScreen');
            showQuestion();
            
            showAlert('üéØ Quiz iniciado! Boa sorte!', 'success');
        }

        function getQuestionsForUser() {
            const db = questionsDatabase[selectedSubject];
            if (!db || !db[currentUser.series]) {
                return [];
            }
            return db[currentUser.series];
        }

        function showQuestion() {
            if (currentQuestion >= currentQuiz.questions.length) {
                endQuiz();
                return;
            }

            const question = currentQuiz.questions[currentQuestion];
            attempts = 0;
            questionStartTime = Date.now();

            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = question.pergunta;
            document.getElementById('progressFill').style.width = 
                `${((currentQuestion + 1) / currentQuiz.questions.length) * 100}%`;

            // Preparar respostas
            const correctAnswer = question.respostas[question.correta];
            const wrongAnswers = question.respostas.filter((_, i) => i !== question.correta);
            const randomWrong = shuffleArray(wrongAnswers).slice(0, 4);
            const allAnswers = shuffleArray([correctAnswer, ...randomWrong]);
            const correctIndex = allAnswers.indexOf(correctAnswer);

            const container = document.getElementById('answersContainer');
            container.innerHTML = '';

            allAnswers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = `${index + 1}. ${answer}`;
                btn.onclick = () => selectAnswer(index, correctIndex);
                btn.id = `answer-${index}`;
                container.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            const timeLimit = {
                'easy': 30,
                'medium': 20,
                'hard': 10
            }[selectedDifficulty];

            let timeLeft = timeLimit;
            document.getElementById('timer').textContent = timeLeft;

            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;

                // Mudan√ßa de cor conforme o tempo
                const timerElement = document.getElementById('timer');
                if (timeLeft <= 5) {
                    timerElement.style.color = '#dc3545';
                    timerElement.style.animation = 'pulse 1s infinite';
                } else if (timeLeft <= 10) {
                    timerElement.style.color = '#ffc107';
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    selectAnswer(-1, -1); // Timeout
                }
            }, 1000);
        }

        function selectAnswer(selectedIndex, correctIndex) {
            clearInterval(timerInterval);
            attempts++;

            const answerBtns = document.querySelectorAll('.answer-btn');
            const timeSpent = (Date.now() - questionStartTime) / 1000;
            totalTime += timeSpent;
            
            if (selectedIndex === correctIndex) {
                // Resposta correta
                answerBtns[selectedIndex].classList.add('correct');
                correctAnswers++;
                
                const points = calculatePoints(timeSpent, attempts, selectedDifficulty);
                score += points;
                document.getElementById('quizScore').textContent = score;

                showAlert(`‚úÖ Correto! +${points} pontos`, 'success');

                setTimeout(() => {
                    currentQuestion++;
                    showQuestion();
                }, 1500);
            } else {
                // Resposta errada
                if (selectedIndex >= 0) {
                    answerBtns[selectedIndex].classList.add('incorrect');
                }
                
                if (attempts >= 4 || selectedIndex === -1) {
                    // Mostrar resposta correta ap√≥s 4 tentativas ou timeout
                    answerBtns[correctIndex].classList.add('correct');
                    
                    if (selectedIndex === -1) {
                        showAlert('‚è∞ Tempo esgotado!', 'warning');
                    } else {
                        showAlert(`‚ùå Resposta correta: ${answerBtns[correctIndex].textContent}`, 'danger');
                    }
                    
                    setTimeout(() => {
                        currentQuestion++;
                        showQuestion();
                    }, 2500);
                } else {
                    showAlert(`‚ùå Tente novamente! (${attempts}/4)`, 'warning');
                    setTimeout(() => {
                        if (answerBtns[selectedIndex]) {
                            answerBtns[selectedIndex].classList.remove('incorrect');
                        }
                    }, 1000);
                }
            }
        }

        function calculatePoints(timeSpent, attempts, difficulty) {
            const difficultyMultiplier = {
                'easy': 1,
                'medium': 1.5,
                'hard': 2
            };

            const basePoints = 100 * difficultyMultiplier[difficulty];
            const timeBonus = Math.max(0, (30 - timeSpent) * 3);
            const attemptPenalty = (attempts - 1) * 25;
            
            return Math.max(10, Math.round(basePoints + timeBonus - attemptPenalty));
        }

        function endQuiz() {
            clearInterval(timerInterval);
            
            // Calcular estat√≠sticas
            const accuracy = Math.round((correctAnswers / currentQuiz.questions.length) * 100);
            const avgTime = Math.round(totalTime / currentQuiz.questions.length);
            
            // Salvar estat√≠sticas
            saveUserStats();
            
            // Mostrar resultado
            document.getElementById('finalScore').textContent = score;
            document.getElementById('resultStats').innerHTML = `
                üìä Acertos: ${correctAnswers}/${currentQuiz.questions.length} (${accuracy}%)<br>
                ‚è±Ô∏è Tempo m√©dio: ${avgTime}s por quest√£o<br>
                üéØ Dificuldade: ${selectedDifficulty.toUpperCase()}<br>
                üìö Mat√©ria: ${selectedSubject.toUpperCase()}
            `;
            
            let message = '';
            let icon = '';
            
            if (score >= 1000) {
                message = 'üåü PERFEITO! Voc√™ √© um verdadeiro expert!';
                icon = 'üëë';
            } else if (score >= 800) {
                message = 'üéâ EXCELENTE! Parab√©ns pelo desempenho!';
                icon = 'üèÜ';
            } else if (score >= 600) {
                message = 'üëè MUITO BOM! Continue assim!';
                icon = 'ü•à';
            } else if (score >= 400) {
                message = 'üëç BOM! Voc√™ est√° no caminho certo!';
                icon = 'ü•â';
            } else {
                message = 'üí™ Continue estudando! A pr√°tica leva √† perfei√ß√£o!';
                icon = 'üìö';
            }
            
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('resultIcon').textContent = icon;
            
            showScreen('resultScreen');
        }

        function saveUserStats() {
            if (!currentUser || currentUser.type !== 'student') return;

            const key = `${currentUser.name}_${currentUser.series}`;
            
            if (!userStats[key]) {
                userStats[key] = {
                    name: currentUser.name,
                    series: currentUser.series,
                    totalScore: 0,
                    quizCount: 0,
                    bestScore: 0,
                    subjects: {}
                };
            }

            userStats[key].totalScore += score;
            userStats[key].quizCount += 1;
            userStats[key].bestScore = Math.max(userStats[key].bestScore, score);
            
            // Estat√≠sticas por mat√©ria
            if (!userStats[key].subjects[selectedSubject]) {
                userStats[key].subjects[selectedSubject] = {
                    count: 0,
                    totalScore: 0
                };
            }
            
            userStats[key].subjects[selectedSubject].count++;
            userStats[key].subjects[selectedSubject].totalScore += score;
            
            localStorage.setItem('userStats', JSON.stringify(userStats));
            loadUserScore();
        }

        function loadUserScore() {
            if (!currentUser || currentUser.type !== 'student') return;

            const key = `${currentUser.name}_${currentUser.series}`;
            const stats = userStats[key];
            
            if (stats) {
                document.getElementById('studentScore').textContent = stats.totalScore;
            }
        }

        function showRanking() {
            const tbody = document.getElementById('rankingBody');
            tbody.innerHTML = '';

            const rankings = Object.values(userStats)
                .sort((a, b) => b.totalScore - a.totalScore)
                .slice(0, 15);

            if (rankings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">üìä Nenhum dado dispon√≠vel</td></tr>';
            } else {
                rankings.forEach((user, index) => {
                    const row = document.createElement('tr');
                    const position = index + 1;
                    let medal = '';
                    
                    if (position === 1) medal = 'ü•á';
                    else if (position === 2) medal = 'ü•à';
                    else if (position === 3) medal = 'ü•â';
                    else medal = `${position}¬∫`;
                    
                    row.innerHTML = `
                        <td>${medal}</td>
                        <td>${user.name}</td>
                        <td>${user.series}</td>
                        <td>${user.totalScore}</td>
                        <td>${user.quizCount}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            showScreen('rankingScreen');
        }

        function backToStudent() {
            showScreen('studentScreen');
        }

        // ==========================================
        // FUN√á√ïES ADMINISTRATIVAS
        // ==========================================
        
        function handleFileUpload() {
            const input = document.getElementById('fileInput');
            const file = input.files[0];
            
            if (!file) return;

            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                showAlert('‚ùå Arquivo muito grande! M√°ximo 5MB.', 'danger');
                return;
            }

            document.getElementById('fileName').innerHTML = 
                `üìé <strong>Arquivo selecionado:</strong> ${file.name} (${(file.size/1024).toFixed(1)}KB)`;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    const content = e.target.result;
                    const extension = file.name.split('.').pop().toLowerCase();

                    if (extension === 'json') {
                        data = JSON.parse(content);
                    } else if (extension === 'csv') {
                        data = parseCSV(content);
                    } else if (extension === 'yaml' || extension === 'yml') {
                        data = parseYAML(content);
                    } else {
                        throw new Error('Formato de arquivo n√£o suportado. Use JSON, CSV ou YAML.');
                    }

                    processUploadedData(data);
                    
                } catch (error) {
                    document.getElementById('uploadStatus').innerHTML = 
                        `<div style="color: #dc3545; padding: 1.5rem; background: rgba(248, 215, 218, 0.9); border-radius: 12px; border-left: 5px solid #dc3545;">
                            ‚ùå <strong>Erro ao processar arquivo:</strong><br>
                            ${error.message}
                        </div>`;
                    showAlert('‚ùå Erro no arquivo! Verifique o formato.', 'danger');
                }
            };
            
            reader.readAsText(file);
        }

        function parseCSV(content) {
            const lines = content.split('\n').filter(line => line.trim() && !line.startsWith('#'));
            if (lines.length < 2) {
                throw new Error('CSV deve ter pelo menos um cabe√ßalho e uma linha de dados.');
            }

            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = {
                materia: '',
                serie: '',
                questoes: []
            };

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                // Parse CSV line handling quoted values
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < lines[i].length; j++) {
                    const char = lines[i][j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());

                if (values.length < 9) continue;

                const question = {
                    pergunta: values[0],
                    respostas: values.slice(1, 7),
                    correta: 0, // Primeira resposta √© sempre correta no CSV
                    dificuldade: values[7] || 'medium'
                };

                data.questoes.push(question);
                
                if (i === 1) {
                    data.materia = values[8] || 'ortografia';
                    data.serie = values[9] || '6ano';
                }
            }

            return data;
        }

        function parseYAML(content) {
            const lines = content.split('\n').filter(line => !line.trim().startsWith('#'));
            const data = {
                materia: '',
                serie: '',
                questoes: []
            };

            let currentQuestion = null;
            let inRespostas = false;

            lines.forEach(line => {
                const trimmed = line.trim();
                
                if (trimmed.startsWith('materia:')) {
                    data.materia = trimmed.split(':')[1].trim().replace(/['"]/g, '');
                } else if (trimmed.startsWith('serie:')) {
                    data.serie = trimmed.split(':')[1].trim().replace(/['"]/g, '');
                } else if (trimmed.startsWith('- pergunta:')) {
                    if (currentQuestion) {
                        data.questoes.push(currentQuestion);
                    }
                    currentQuestion = {
                        pergunta: trimmed.split(':', 2)[1].trim().replace(/['"]/g, ''),
                        respostas: [],
                        correta: 0,
                        dificuldade: 'medium'
                    };
                    inRespostas = false;
                } else if (trimmed.startsWith('respostas:')) {
                    inRespostas = true;
                } else if (trimmed.startsWith('- ') && inRespostas && currentQuestion) {
                    const answer = trimmed.substring(2).replace(/['"]/g, '').split('#')[0].trim();
                    currentQuestion.respostas.push(answer);
                } else if (trimmed.startsWith('correta:') && currentQuestion) {
                    currentQuestion.correta = parseInt(trimmed.split(':')[1].trim()) || 0;
                } else if (trimmed.startsWith('dificuldade:') && currentQuestion) {
                    currentQuestion.dificuldade = trimmed.split(':')[1].trim().replace(/['"]/g, '');
                }
            });

            if (currentQuestion) {
                data.questoes.push(currentQuestion);
            }

            return data;
        }

        function processUploadedData(data) {
            let totalQuestionsAdded = 0;
            let processedItems = [];

            // Se o dados tiver a estrutura com array "quiz", processe cada item
            if (data.quiz && Array.isArray(data.quiz)) {
                data.quiz.forEach(quizItem => {
                    // Valida√ß√µes para cada item do quiz
                    if (!quizItem.materia || !quizItem.serie || !quizItem.questoes || quizItem.questoes.length === 0) {
                        throw new Error('Estrutura inv√°lida. Verifique os campos: materia, serie, questoes.');
                    }
                    
                    // Processar cada item do quiz individualmente
                    const result = processQuizItem(quizItem);
                    totalQuestionsAdded += result.questionsAdded;
                    processedItems.push(result.summary);
                });

                // Feedback consolidado para m√∫ltiplos itens
                document.getElementById('uploadStatus').innerHTML = 
                    `<div style="color: #155724; padding: 1.5rem; background: rgba(212, 237, 218, 0.9); border-radius: 12px; border-left: 5px solid #28a745;">
                        ‚úÖ <strong>Upload em lote realizado com sucesso!</strong><br>
                        üìä ${totalQuestionsAdded} quest√µes adicionadas em ${processedItems.length} mat√©rias/s√©ries<br>
                        üìö Processados: ${processedItems.join(', ')}<br>
                        üéØ Todas as quest√µes foram salvas no sistema
                    </div>`;

                showAlert(`‚úÖ ${totalQuestionsAdded} quest√µes adicionadas em ${processedItems.length} grupos!`, 'success');
            } 
            // Se for a estrutura simples, processe normalmente
            else if (data.materia && data.serie && data.questoes) {
                const result = processQuizItem(data);
                showAlert(`‚úÖ ${result.questionsAdded} quest√µes adicionadas!`, 'success');
            } 
            else {
                throw new Error('Estrutura inv√°lida. O arquivo deve conter materia, serie e questoes OU um array "quiz".');
            }

            // Salvar dados persistentes
            saveDataToPersistentFiles();
        }

        function processQuizItem(quizItem) {
            const validMaterias = ['ortografia', 'morfologia', 'redacao', 'sintaxe', 'literatura', 'fonologia'];
            const validSeries = ['5ano', '6ano', '7ano', '8ano', '9ano'];
            const validDificuldades = ['easy', 'medium', 'hard'];

            if (!validMaterias.includes(quizItem.materia)) {
                throw new Error(`Mat√©ria inv√°lida: ${quizItem.materia}. Use: ${validMaterias.join(', ')}`);
            }

            if (!validSeries.includes(quizItem.serie)) {
                throw new Error(`S√©rie inv√°lida: ${quizItem.serie}. Use: ${validSeries.join(', ')}`);
            }

            // Validar quest√µes
            quizItem.questoes.forEach((q, index) => {
                if (!q.pergunta || !q.respostas || q.respostas.length < 5) {
                    throw new Error(`Quest√£o ${index + 1}: Deve ter pergunta e pelo menos 5 respostas.`);
                }
                
                if (q.correta < 0 || q.correta >= q.respostas.length) {
                    throw new Error(`Quest√£o ${index + 1}: √çndice da resposta correta inv√°lido.`);
                }

                if (!validDificuldades.includes(q.dificuldade)) {
                    q.dificuldade = 'medium'; // Default
                }
            });

            // Adicionar ao banco
            if (!questionsDatabase[quizItem.materia]) {
                questionsDatabase[quizItem.materia] = {};
            }

            if (!questionsDatabase[quizItem.materia][quizItem.serie]) {
                questionsDatabase[quizItem.materia][quizItem.serie] = [];
            }

            const beforeCount = questionsDatabase[quizItem.materia][quizItem.serie].length;

            // Verificar duplicatas por pergunta e substituir se necess√°rio
            let addedCount = 0;
            let updatedCount = 0;

            quizItem.questoes.forEach(newQuestion => {
                const existingIndex = questionsDatabase[quizItem.materia][quizItem.serie]
                    .findIndex(q => q.pergunta === newQuestion.pergunta);
                
                if (existingIndex !== -1) {
                    // Substituir quest√£o existente
                    questionsDatabase[quizItem.materia][quizItem.serie][existingIndex] = newQuestion;
                    updatedCount++;
                } else {
                    // Adicionar nova quest√£o
                    questionsDatabase[quizItem.materia][quizItem.serie].push(newQuestion);
                    addedCount++;
                }
            });

            // Salvar localmente
            localStorage.setItem('questionsDatabase', JSON.stringify(questionsDatabase));
            localStorage.setItem('lastUploadDate', new Date().toISOString());

            // Feedback de sucesso para item √∫nico
            if (document.getElementById('uploadStatus')) {
                document.getElementById('uploadStatus').innerHTML = 
                    `<div style="color: #155724; padding: 1.5rem; background: rgba(212, 237, 218, 0.9); border-radius: 12px; border-left: 5px solid #28a745;">
                        ‚úÖ <strong>Upload realizado com sucesso!</strong><br>
                        üìä ${addedCount} quest√µes novas adicionadas, ${updatedCount} quest√µes atualizadas<br>
                        üìö Mat√©ria: ${quizItem.materia} | S√©rie: ${quizItem.serie}<br>
                        üìà Total na base: ${questionsDatabase[quizItem.materia][quizItem.serie].length} quest√µes
                    </div>`;
            }

            // Limpar form
            if (document.getElementById('fileInput')) {
                document.getElementById('fileInput').value = '';
                document.getElementById('fileName').textContent = '';
            }
            
            updateStats();

            return {
                questionsAdded: addedCount + updatedCount,
                summary: `${quizItem.materia}/${quizItem.serie}`
            };
        }

        // Fun√ß√£o para salvar dados em arquivos persistentes
        async function saveDataToPersistentFiles() {
            try {
                // Salvar quest√µes
                const questionsBlob = new Blob([JSON.stringify(questionsDatabase, null, 2)], { type: 'application/json' });
                // Simular salvamento (em ambiente real seria uma requisi√ß√£o ao servidor)
                console.log('üìÅ Dados das quest√µes salvos em questionsDatabase.json');

                // Salvar estat√≠sticas
                const statsBlob = new Blob([JSON.stringify(userStats, null, 2)], { type: 'application/json' });
                console.log('üìä Estat√≠sticas salvas em userStats.json');

                showAlert('üíæ Dados salvos persistentemente!', 'success');
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
            }
        }

        // Fun√ß√£o para carregar arquivos JSON do servidor
        async function loadServerFiles() {
            const filesToLoad = [
                'questionsDatabase.json',
                'userStats.json',
                'ortografia.json',
                'morfologia.json',
                'redacao.json',
                'sintaxe.json',
                'literatura.json',
                'fonologia.json'
            ];

            for (const fileName of filesToLoad) {
                try {
                    const response = await fetch(fileName);
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (fileName === 'userStats.json') {
                            // Mesclar estat√≠sticas, mantendo dados locais
                            userStats = { ...data, ...userStats };
                            localStorage.setItem('userStats', JSON.stringify(userStats));
                        } else if (fileName === 'questionsDatabase.json') {
                            // Mesclar base de quest√µes
                            questionsDatabase = mergeQuestionsDatabase(data, questionsDatabase);
                        } else {
                            // Arquivos individuais de mat√©ria
                            const materia = fileName.replace('.json', '');
                            if (data.quiz && Array.isArray(data.quiz)) {
                                processUploadedData(data);
                            }
                        }
                        
                        console.log(`üìÅ Carregado: ${fileName}`);
                    }
                } catch (error) {
                    // Arquivo n√£o existe ou erro de carregamento - normal em muitos casos
                    console.log(`‚ö†Ô∏è ${fileName} n√£o encontrado ou erro ao carregar`);
                }
            }
        }

        // Fun√ß√£o para mesclar bases de dados de quest√µes
        function mergeQuestionsDatabase(serverData, localData) {
            const merged = { ...localData };

            Object.keys(serverData).forEach(materia => {
                if (!merged[materia]) {
                    merged[materia] = {};
                }

                Object.keys(serverData[materia]).forEach(serie => {
                    if (!merged[materia][serie]) {
                        merged[materia][serie] = [];
                    }

                    // Mesclar quest√µes, priorizando quest√µes do servidor por pergunta
                    serverData[materia][serie].forEach(serverQuestion => {
                        const existingIndex = merged[materia][serie]
                            .findIndex(q => q.pergunta === serverQuestion.pergunta);
                        
                        if (existingIndex !== -1) {
                            // Substituir pela vers√£o do servidor
                            merged[materia][serie][existingIndex] = serverQuestion;
                        } else {
                            // Adicionar nova quest√£o
                            merged[materia][serie].push(serverQuestion);
                        }
                    });
                });
            });

            // Salvar dados mesclados
            localStorage.setItem('questionsDatabase', JSON.stringify(merged));
            return merged;
        }

        function generateSampleFile() {
            showAlert('üì• Gerando arquivos de exemplo...', 'info');
            
            const sampleData = {
                materia: "ortografia",
                serie: "6ano",
                questoes: [
                    {
                        pergunta: "Qual √© a grafia correta?",
                        respostas: [
                            "exce√ß√£o",    // ‚Üê √çNDICE 0 (CORRETA)
                            "excess√£o",   // ‚Üê √çNDICE 1 (incorreta)
                            "exse√ß√£o",    // ‚Üê √çNDICE 2 (incorreta) 
                            "exces√£o",    // ‚Üê √çNDICE 3 (incorreta)
                            "exe√ß√£o",     // ‚Üê √çNDICE 4 (incorreta)
                            "ece√ß√£o"      // ‚Üê √çNDICE 5 (incorreta)
                        ],
                        correta: 0,  // ‚Üê Este n√∫mero indica qual resposta √© correta (0 = primeira)
                        dificuldade: "medium"
                    },
                    {
                        pergunta: "Complete a frase: Ontem eu _____ ao cinema.",
                        respostas: [
                            "foi",        // ‚Üê √çNDICE 0 (incorreta)
                            "fui",        // ‚Üê √çNDICE 1 (CORRETA - indicada abaixo)
                            "fomos",      // ‚Üê √çNDICE 2 (incorreta)
                            "foram",      // ‚Üê √çNDICE 3 (incorreta)
                            "fostes",     // ‚Üê √çNDICE 4 (incorreta)
                            "ides"        // ‚Üê √çNDICE 5 (incorreta)
                        ],
                        correta: 1,  // ‚Üê A resposta correta √© o √çNDICE 1 ("fui")
                        dificuldade: "easy"
                    },
                    {
                        pergunta: "Qual palavra est√° com a acentua√ß√£o correta?",
                        respostas: [
                            "medico",     // ‚Üê √çNDICE 0 (incorreta)
                            "medic√¥",     // ‚Üê √çNDICE 1 (incorreta)
                            "m√©dico",     // ‚Üê √çNDICE 2 (CORRETA - indicada abaixo)
                            "m√©dic√¥",     // ‚Üê √çNDICE 3 (incorreta)
                            "med√≠co",     // ‚Üê √çNDICE 4 (incorreta)
                            "med√≠c√¥"      // ‚Üê √çNDICE 5 (incorreta)
                        ],
                        correta: 2,  // ‚Üê A resposta correta √© o √çNDICE 2 ("m√©dico")
                        dificuldade: "hard"
                    }
                ]
            };

            // Criar conte√∫do JSON com explica√ß√µes
            const explanations = `/*
===============================================
    üìö QUIZ L√çNGUA PORTUGUESA - ARQUIVO EXEMPLO
===============================================

üéØ COMO INDICAR A RESPOSTA CORRETA:
   Use o campo "correta" com o √çNDICE da resposta:
   ‚Ä¢ 0 = primeira resposta
   ‚Ä¢ 1 = segunda resposta  
   ‚Ä¢ 2 = terceira resposta
   ‚Ä¢ 3 = quarta resposta
   ‚Ä¢ 4 = quinta resposta
   ‚Ä¢ 5 = sexta resposta

üìã ESTRUTURA OBRIGAT√ìRIA:
   ‚Ä¢ materia: ortografia, morfologia, redacao, sintaxe, literatura, fonologia
   ‚Ä¢ serie: 5ano, 6ano, 7ano, 8ano, 9ano
   ‚Ä¢ questoes: array com as perguntas
   ‚Ä¢ pergunta: texto da quest√£o
   ‚Ä¢ respostas: array com exatamente 6 op√ß√µes
   ‚Ä¢ correta: √≠ndice (0-5) da resposta certa
   ‚Ä¢ dificuldade: easy (30s), medium (20s), hard (10s)

‚ö†Ô∏è  IMPORTANTE:
   ‚Ä¢ Sempre forne√ßa 6 respostas (1 correta + 5 incorretas)
   ‚Ä¢ O sistema mostra 5 alternativas aleat√≥rias (1 certa + 4 erradas)
   ‚Ä¢ Respostas s√£o embaralhadas automaticamente

üí° EXEMPLO CSV ALTERNATIVO:
   No formato CSV, a PRIMEIRA coluna de resposta √© sempre a correta

===============================================
*/

`;

            const jsonString = explanations + JSON.stringify(sampleData, null, 2);
            downloadFile(jsonString, 'exemplo_questoes_com_instrucoes.json', 'application/json');

            // Gerar CSV
            setTimeout(() => {
                const csvContent = `# INSTRU√á√ïES PARA ARQUIVO CSV:
# - A PRIMEIRA resposta (Resposta1) √© SEMPRE a correta
# - Forne√ßa 6 respostas: Resposta1 (correta) + Resposta2 a Resposta6 (incorretas)
# - Mat√©rias: ortografia, morfologia, redacao, sintaxe, literatura, fonologia
# - S√©ries: 5ano, 6ano, 7ano, 8ano, 9ano
# - Dificuldades: easy, medium, hard

Pergunta,Resposta1_CORRETA,Resposta2,Resposta3,Resposta4,Resposta5,Resposta6,Dificuldade,Materia,Serie
"Qual a grafia correta?",exce√ß√£o,excess√£o,exse√ß√£o,exces√£o,exe√ß√£o,ece√ß√£o,medium,ortografia,6ano
"Complete: Ontem eu _____ ao cinema.",fui,foi,fomos,foram,fostes,ides,easy,ortografia,6ano
"Qual palavra tem acentua√ß√£o correta?",m√©dico,medico,medic√¥,m√©dic√¥,med√≠co,med√≠c√¥,hard,ortografia,6ano`;

                downloadFile(csvContent, 'exemplo_questoes.csv', 'text/csv');
            }, 1000);

            // Gerar YAML
            setTimeout(() => {
                const yamlContent = `# ===============================================
# üìö QUIZ L√çNGUA PORTUGUESA - EXEMPLO YAML
# ===============================================
#
# üéØ COMO INDICAR A RESPOSTA CORRETA:
#    Use o campo "correta" com o √çNDICE da resposta:
#    ‚Ä¢ 0 = primeira resposta
#    ‚Ä¢ 1 = segunda resposta  
#    ‚Ä¢ 2 = terceira resposta
#    ‚Ä¢ 3 = quarta resposta
#    ‚Ä¢ 4 = quinta resposta
#    ‚Ä¢ 5 = sexta resposta
#
# üìã CAMPOS OBRIGAT√ìRIOS:
#    ‚Ä¢ materia: ortografia, morfologia, redacao, sintaxe, literatura, fonologia
#    ‚Ä¢ serie: 5ano, 6ano, 7ano, 8ano, 9ano
#    ‚Ä¢ questoes: lista de perguntas
#    ‚Ä¢ pergunta: texto da quest√£o
#    ‚Ä¢ respostas: lista com exatamente 6 op√ß√µes
#    ‚Ä¢ correta: √≠ndice (0-5) da resposta certa
#    ‚Ä¢ dificuldade: easy (30s), medium (20s), hard (10s)
#
# ‚ö†Ô∏è  IMPORTANTE:
#    ‚Ä¢ Sempre forne√ßa 6 respostas (1 correta + 5 incorretas)
#    ‚Ä¢ O sistema mostra 5 alternativas aleat√≥rias
#    ‚Ä¢ Respostas s√£o embaralhadas automaticamente
#
# ===============================================

materia: ortografia
serie: 6ano
questoes:
  - pergunta: "Qual √© a grafia correta?"
    respostas:
      - "exce√ß√£o"     # ‚Üê √çNDICE 0 (CORRETA - veja campo 'correta' abaixo)
      - "excess√£o"    # ‚Üê √çNDICE 1 (incorreta)
      - "exse√ß√£o"     # ‚Üê √çNDICE 2 (incorreta)
      - "exces√£o"     # ‚Üê √çNDICE 3 (incorreta)
      - "exe√ß√£o"      # ‚Üê √çNDICE 4 (incorreta)
      - "ece√ß√£o"      # ‚Üê √çNDICE 5 (incorreta)
    correta: 0        # ‚Üê Este n√∫mero indica que a resposta do √çNDICE 0 √© correta
    dificuldade: "medium"

  - pergunta: "Complete a frase: Ontem eu _____ ao cinema."
    respostas:
      - "foi"         # ‚Üê √çNDICE 0 (incorreta)
      - "fui"         # ‚Üê √çNDICE 1 (CORRETA - veja campo 'correta' abaixo)
      - "fomos"       # ‚Üê √çNDICE 2 (incorreta)
      - "foram"       # ‚Üê √çNDICE 3 (incorreta)
      - "fostes"      # ‚Üê √çNDICE 4 (incorreta)
      - "ides"        # ‚Üê √çNDICE 5 (incorreta)
    correta: 1        # ‚Üê A resposta correta √© do √çNDICE 1 ("fui")
    dificuldade: "easy"

  - pergunta: "Qual palavra est√° com a acentua√ß√£o correta?"
    respostas:
      - "medico"      # ‚Üê √çNDICE 0 (incorreta)
      - "medic√¥"      # ‚Üê √çNDICE 1 (incorreta)
      - "m√©dico"      # ‚Üê √çNDICE 2 (CORRETA - veja campo 'correta' abaixo)
      - "m√©dic√¥"      # ‚Üê √çNDICE 3 (incorreta)
      - "med√≠co"      # ‚Üê √çNDICE 4 (incorreta)
      - "med√≠c√¥"      # ‚Üê √çNDICE 5 (incorreta)
    correta: 2        # ‚Üê A resposta correta √© do √çNDICE 2 ("m√©dico")
    dificuldade: "hard"

# ===============================================
# üí° DICAS ADICIONAIS:
#    ‚Ä¢ Use aspas duplas para textos com caracteres especiais
#    ‚Ä¢ Mantenha a indenta√ß√£o consistente (2 espa√ßos)
#    ‚Ä¢ Teste o arquivo antes de fazer upload
#    ‚Ä¢ Em caso de erro, verifique a sintaxe YAML
# ===============================================`;

                downloadFile(yamlContent, 'exemplo_questoes.yaml', 'text/yaml');
            }, 2000);

            setTimeout(() => {
                showAlert('üì• Tr√™s arquivos de exemplo foram baixados: JSON, CSV e YAML!', 'success');
            }, 3000);
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function updateStats() {
            const totalUsers = Object.keys(userStats).length;
            const totalQuizzes = Object.values(userStats).reduce((sum, user) => sum + user.quizCount, 0);
            const totalQuestions = Object.values(questionsDatabase).reduce((sum, materia) => {
                return sum + Object.values(materia).reduce((sum2, serie) => sum2 + serie.length, 0);
            }, 0);
            const totalSubjects = Object.keys(questionsDatabase).length;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalQuizzes').textContent = totalQuizzes;
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('totalSubjects').textContent = totalSubjects;
        }

        function showDetailedStats() {
            const stats = Object.values(userStats);
            const avgScore = stats.length > 0 ? Math.round(stats.reduce((sum, user) => sum + user.totalScore, 0) / stats.length) : 0;
            const topScore = stats.length > 0 ? Math.max(...stats.map(user => user.bestScore)) : 0;

            alert(`üìà RELAT√ìRIO DETALHADO DO SISTEMA

üë• USU√ÅRIOS:
   ‚Ä¢ Total de estudantes: ${stats.length}
   ‚Ä¢ Pontua√ß√£o m√©dia: ${avgScore}
   ‚Ä¢ Melhor pontua√ß√£o: ${topScore}

üìä ATIVIDADE:
   ‚Ä¢ Total de quizzes: ${stats.reduce((sum, user) => sum + user.quizCount, 0)}
   ‚Ä¢ M√©dia por usu√°rio: ${stats.length > 0 ? Math.round(stats.reduce((sum, user) => sum + user.quizCount, 0) / stats.length) : 0}

üìö CONTE√öDO:
   ‚Ä¢ Mat√©rias dispon√≠veis: ${Object.keys(questionsDatabase).length}
   ‚Ä¢ Total de quest√µes: ${Object.values(questionsDatabase).reduce((sum, materia) => sum + Object.values(materia).reduce((sum2, serie) => sum2 + serie.length, 0), 0)}

üéØ POR MAT√âRIA:
${Object.entries(questionsDatabase).map(([materia, series]) => {
    const count = Object.values(series).reduce((sum, arr) => sum + arr.length, 0);
    return `   ‚Ä¢ ${materia}: ${count} quest√µes`;
}).join('\n')}

üìÖ √öltimo upload: ${lastUploadDate ? new Date(lastUploadDate).toLocaleString('pt-BR') : 'Nunca'}`);
        }

        function exportData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                version: '2.0.0',
                questionsDatabase: questionsDatabase,
                userStats: userStats,
                systemInfo: {
                    totalUsers: Object.keys(userStats).length,
                    totalQuestions: Object.values(questionsDatabase).reduce((sum, materia) => {
                        return sum + Object.values(materia).reduce((sum2, serie) => sum2 + serie.length, 0);
                    }, 0)
                }
            };

            const jsonString = JSON.stringify(exportData, null, 2);
            downloadFile(jsonString, `quiz_backup_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showAlert('üíæ Backup dos dados exportado!', 'success');
        }

        function checkForNewQuizzes() {
            const lastCheck = localStorage.getItem('lastUserCheck_' + currentUser.name);
            const lastUpload = localStorage.getItem('lastUploadDate');
            
            if (lastUpload && (!lastCheck || new Date(lastUpload) > new Date(lastCheck))) {
                document.getElementById('newQuizNotification').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('newQuizNotification').style.display = 'none';
                }, 8000);
            }
            
            localStorage.setItem('lastUserCheck_' + currentUser.name, new Date().toISOString());
        }

        function downloadApp() {
            const manifest = {
                "name": "Quiz L√≠ngua Portuguesa",
                "short_name": "Quiz LP",
                "description": "App educativo para aprender L√≠ngua Portuguesa",
                "start_url": "/",
                "display": "standalone",
                "background_color": "#667eea",
                "theme_color": "#764ba2",
                "orientation": "portrait-primary",
                "categories": ["education", "games"],
                "lang": "pt-BR",
                "icons": [
                    {
                        "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzY2N2VlYSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6Izc2NGJhMiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+PHRleHQgeD0iOTYiIHk9IjExMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjcwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkxQPC90ZXh0Pjwvc3ZnPg==",
                        "sizes": "192x192",
                        "type": "image/svg+xml"
                    }
                ]
            };

            alert(`üì± COMO INSTALAR O QUIZ LP COMO APP:

üîπ CHROME/EDGE (PC/Android):
   1. Clique nos 3 pontos (‚ãÆ) no menu
   2. Selecione "Instalar Quiz LP" ou "Adicionar √† tela inicial"

üîπ SAFARI (iPhone/iPad):
   1. Toque no bot√£o Compartilhar (üì§)
   2. Role para baixo e toque "Adicionar √† Tela de In√≠cio"
   3. Confirme tocando "Adicionar"

üîπ FIREFOX:
   1. Abra o menu (‚ò∞)
   2. Selecione "Instalar"

‚ú® VANTAGENS DO APP:
   ‚Ä¢ Funciona offline ap√≥s primeira visita
   ‚Ä¢ √çcone na tela inicial do celular
   ‚Ä¢ Experi√™ncia de app nativo
   ‚Ä¢ Notifica√ß√µes push (futuro)
   ‚Ä¢ Carregamento mais r√°pido

üåê ACESSE: Salve este endere√ßo nos favoritos para instalar depois!`);
        }

        // ==========================================
        // UTILIT√ÅRIOS E INICIALIZA√á√ÉO
        // ==========================================
        
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Event Listeners
        document.getElementById('subjectSelect').addEventListener('change', updateStartButton);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (currentUser && document.getElementById('quizScreen').classList.contains('active')) {
                const key = e.key;
                if (['1', '2', '3', '4', '5'].includes(key)) {
                    e.preventDefault();
                    const buttons = document.querySelectorAll('.answer-btn');
                    const index = parseInt(key) - 1;
                    if (buttons[index] && !buttons[index].classList.contains('correct') && !buttons[index].classList.contains('incorrect')) {
                        buttons[index].click();
                    }
                }
            }
        });

        // PWA Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swScript = `
                    const CACHE_NAME = 'quiz-lp-v2';
                    const urlsToCache = [
                        '/',
                        '/index.html'
                    ];

                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    return response || fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swScript], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('‚úÖ Service Worker registrado'))
                    .catch(() => console.log('‚ùå Erro no Service Worker'));
            });
        }

        // Carregar dados salvos e arquivos do servidor
        window.addEventListener('load', async () => {
            // Carregar quest√µes salvas do localStorage
            const savedQuestions = localStorage.getItem('questionsDatabase');
            if (savedQuestions) {
                try {
                    questionsDatabase = { ...questionsDatabase, ...JSON.parse(savedQuestions) };
                } catch (e) {
                    console.log('Erro ao carregar quest√µes salvas');
                }
            }

            // Carregar arquivos JSON do servidor
            await loadServerFiles();

            // Atualizar estat√≠sticas da tela de login
            updateLoginStats();

            // Carregar usu√°rio salvo
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    if (user.type === 'student') {
                        document.getElementById('studentName').value = user.name || '';
                        document.getElementById('studentSeries').value = user.series || '';
                    }
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            }

            // Auto-save a cada 30 segundos
            setInterval(() => {
                if (currentUser && currentUser.type === 'student') {
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                // Auto-save das quest√µes e estat√≠sticas
                saveDataToPersistentFiles();
            }, 30000);

            console.log('üéâ Quiz L√≠ngua Portuguesa v2.0.0 carregado!');
            console.log('üìö Sistema educacional completo ativo');
            console.log('üìÅ Carregamento de arquivos JSON do servidor conclu√≠do');
            
            showAlert('üéâ Sistema carregado! Todos os dados foram sincronizados.', 'info');
        });

        // Fun√ß√£o melhorada para gerar exemplos incluindo formato de m√∫ltiplas mat√©rias
        function generateSampleFile() {
            showAlert('üì• Gerando arquivos de exemplo...', 'info');
            
            // Exemplo simples (formato original)
            const sampleDataSimple = {
                materia: "ortografia",
                serie: "6ano",
                questoes: [
                    {
                        pergunta: "Qual √© a grafia correta?",
                        respostas: [
                            "exce√ß√£o",    // ‚Üê √çNDICE 0 (CORRETA)
                            "excess√£o",   // ‚Üê √çNDICE 1 (incorreta)
                            "exse√ß√£o",    // ‚Üê √çNDICE 2 (incorreta) 
                            "exces√£o",    // ‚Üê √çNDICE 3 (incorreta)
                            "exe√ß√£o",     // ‚Üê √çNDICE 4 (incorreta)
                            "ece√ß√£o"      // ‚Üê √çNDICE 5 (incorreta)
                        ],
                        correta: 0,
                        dificuldade: "medium"
                    }
                ]
            };

            // Exemplo de m√∫ltiplas mat√©rias (novo formato)
            const sampleDataMultiple = {
                quiz: [
                    {
                        materia: "ortografia",
                        serie: "6ano",
                        questoes: [
                            {
                                pergunta: "Qual √© a grafia correta?",
                                respostas: ["exce√ß√£o", "excess√£o", "exse√ß√£o", "exces√£o", "exe√ß√£o", "ece√ß√£o"],
                                correta: 0,
                                dificuldade: "medium"
                            },
                            {
                                pergunta: "Complete: Ontem eu _____ ao cinema.",
                                respostas: ["fui", "foi", "fomos", "foram", "fostes", "ides"],
                                correta: 0,
                                dificuldade: "easy"
                            }
                        ]
                    },
                    {
                        materia: "morfologia",
                        serie: "6ano",
                        questoes: [
                            {
                                pergunta: "Qual √© o plural de 'l√°pis'?",
                                respostas: ["l√°pis", "lapis", "l√°pises", "l√°pisses", "lapiss", "lapizes"],
                                correta: 0,
                                dificuldade: "easy"
                            }
                        ]
                    },
                    {
                        materia: "ortografia",
                        serie: "7ano",
                        questoes: [
                            {
                                pergunta: "Qual palavra tem acentua√ß√£o correta?",
                                respostas: ["m√©dico", "medico", "medic√¥", "m√©dic√¥", "med√≠co", "med√≠c√¥"],
                                correta: 0,
                                dificuldade: "hard"
                            }
                        ]
                    }
                ]
            };

            // Criar conte√∫do JSON com explica√ß√µes
            const explanations = `/*
===============================================
    üìö QUIZ L√çNGUA PORTUGUESA - EXEMPLOS v2.0
===============================================

üÜï NOVO: SUPORTE A M√öLTIPLAS MAT√âRIAS EM UM S√ì ARQUIVO!

üéØ FORMATOS SUPORTADOS:

1Ô∏è‚É£ FORMATO SIMPLES (uma mat√©ria por arquivo):
   {
     "materia": "ortografia",
     "serie": "6ano",
     "questoes": [...]
   }

2Ô∏è‚É£ FORMATO M√öLTIPLO (v√°rias mat√©rias em um arquivo):
   {
     "quiz": [
       {
         "materia": "ortografia",
         "serie": "6ano",
         "questoes": [...]
       },
       {
         "materia": "morfologia",  
         "serie": "7ano",
         "questoes": [...]
       }
     ]
   }

üìã COMO INDICAR RESPOSTA CORRETA:
   ‚Ä¢ Use o campo "correta" com o √çNDICE (0-5)
   ‚Ä¢ 0 = primeira resposta (sempre correta no exemplo)
   ‚Ä¢ 1 = segunda resposta, etc.

üìö MAT√âRIAS: ortografia, morfologia, redacao, sintaxe, literatura, fonologia
üéì S√âRIES: 5ano, 6ano, 7ano, 8ano, 9ano  
‚ö° DIFICULDADES: easy (30s), medium (20s), hard (10s)

‚ö†Ô∏è IMPORTANTE:
   ‚Ä¢ Sempre 6 respostas (1 correta + 5 incorretas)
   ‚Ä¢ Sistema mostra 5 aleat√≥rias (1 certa + 4 erradas)
   ‚Ä¢ Quest√µes com mesma pergunta s√£o substitu√≠das
   ‚Ä¢ Upload preserva dados locais + servidor

===============================================
*/

EXEMPLO FORMATO SIMPLES:
`;

            const explanationsMultiple = `

EXEMPLO FORMATO M√öLTIPLO (RECOMENDADO):
`;

            // Gerar arquivos
            setTimeout(() => {
                const jsonSimple = explanations + JSON.stringify(sampleDataSimple, null, 2);
                downloadFile(jsonSimple, 'exemplo_simples_uma_materia.json', 'application/json');
            }, 500);

            setTimeout(() => {
                const jsonMultiple = explanationsMultiple + JSON.stringify(sampleDataMultiple, null, 2);
                downloadFile(jsonMultiple, 'exemplo_multiplas_materias.json', 'application/json');
            }, 1000);

            // Gerar CSV
            setTimeout(() => {
                const csvContent = `# INSTRU√á√ïES PARA ARQUIVO CSV:
# - A PRIMEIRA resposta (Resposta1) √© SEMPRE a correta
# - Para m√∫ltiplas mat√©rias, use v√°rias linhas com Materia/Serie diferentes
# - Sistema agrupa automaticamente por mat√©ria/s√©rie

Pergunta,Resposta1_CORRETA,Resposta2,Resposta3,Resposta4,Resposta5,Resposta6,Dificuldade,Materia,Serie
"Qual a grafia correta?",exce√ß√£o,excess√£o,exse√ß√£o,exces√£o,exe√ß√£o,ece√ß√£o,medium,ortografia,6ano
"Complete: Ontem eu ___ ao cinema.",fui,foi,fomos,foram,fostes,ides,easy,ortografia,6ano
"Qual √© o plural de l√°pis?",l√°pis,lapis,l√°pises,l√°pisses,lapiss,lapizes,easy,morfologia,6ano
"Palavra com acentua√ß√£o correta:",m√©dico,medico,medic√¥,m√©dic√¥,med√≠co,med√≠c√¥,hard,ortografia,7ano`;

                downloadFile(csvContent, 'exemplo_multiplas_materias.csv', 'text/csv');
            }, 1500);

            // Gerar YAML
            setTimeout(() => {
                const yamlContent = `# ===============================================
# üìö QUIZ L√çNGUA PORTUGUESA - EXEMPLO M√öLTIPLO
# ===============================================

# üÜï FORMATO PARA M√öLTIPLAS MAT√âRIAS/S√âRIES:
quiz:
  - materia: ortografia
    serie: 6ano
    questoes:
      - pergunta: "Qual √© a grafia correta?"
        respostas:
          - "exce√ß√£o"     # ‚Üê √çNDICE 0 (CORRETA)
          - "excess√£o"    # ‚Üê √çNDICE 1 (incorreta)
          - "exse√ß√£o"     # ‚Üê √çNDICE 2 (incorreta)
          - "exces√£o"     # ‚Üê √çNDICE 3 (incorreta)
          - "exe√ß√£o"      # ‚Üê √çNDICE 4 (incorreta)
          - "ece√ß√£o"      # ‚Üê √çNDICE 5 (incorreta)
        correta: 0
        dificuldade: "medium"

  - materia: morfologia
    serie: 6ano
    questoes:
      - pergunta: "Qual √© o plural de 'l√°pis'?"
        respostas:
          - "l√°pis"       # ‚Üê CORRETA
          - "lapis"
          - "l√°pises"
          - "l√°pisses"
          - "lapiss"
          - "lapizes"
        correta: 0
        dificuldade: "easy"

  - materia: ortografia
    serie: 7ano
    questoes:
      - pergunta: "Qual palavra tem acentua√ß√£o correta?"
        respostas:
          - "m√©dico"      # ‚Üê CORRETA
          - "medico"
          - "medic√¥"
          - "m√©dic√¥"
          - "med√≠co"
          - "med√≠c√¥"
        correta: 0
        dificuldade: "hard"

# üí° VANTAGENS DO FORMATO M√öLTIPLO:
#   ‚Ä¢ Um arquivo para v√°rias mat√©rias
#   ‚Ä¢ Organiza√ß√£o mais eficiente  
#   ‚Ä¢ Upload em lote
#   ‚Ä¢ F√°cil manuten√ß√£o`;

                downloadFile(yamlContent, 'exemplo_multiplas_materias.yaml', 'text/yaml');
            }, 2000);

            setTimeout(() => {
                showAlert('üì• Quatro arquivos de exemplo baixados: JSON simples, JSON m√∫ltiplo, CSV e YAML!', 'success');
            }, 2500);
        }

        // Manifest din√¢mico
        const manifestData = {
            "name": "Quiz L√≠ngua Portuguesa",
            "short_name": "Quiz LP",
            "description": "App educativo para aprender L√≠ngua Portuguesa de forma divertida",
            "start_url": window.location.pathname,
            "display": "standalone",
            "background_color": "#667eea",
            "theme_color": "#764ba2",
            "orientation": "portrait-primary",
            "categories": ["education", "games"],
            "lang": "pt-BR",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzY2N2VlYSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6Izc2NGJhMiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+PHRleHQgeD0iOTYiIHk9IjExMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjcwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkxQPC90ZXh0Pjwvc3ZnPg==",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestUrl;

        // Adicionar estilos CSS para anima√ß√µes
        const additionalStyles = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        `;

        const styleElement = document.createElement('style');
        styleElement.textContent = additionalStyles;
        document.head.appendChild(styleElement);

    </script>
</body>
</html><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz L√≠ngua Portuguesa</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="App educativo para aprender L√≠ngua Portuguesa de forma divertida">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quiz LP">
    
    <!-- Manifest -->
    <link rel="manifest" id="manifest-placeholder">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzY2N2VlYSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6Izc2NGJhMiIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+PHRleHQgeD0iOTYiIHk9IjExMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjcwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkxQPC90ZXh0Pjwvc3ZnPg==">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --dark-color: #333;
            --light-bg: rgba(255, 255, 255, 0.95);
            --border-radius: 15px;
            --box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            background: var(--light-bg);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: var(--box-shadow);
            max-width: 900px;
            width: 95%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            color: var(--dark-color);
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-success {
            background: var(--success-color);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: var(--danger-color);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.8rem;
            color: var(--dark-color);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(248, 249, 250, 0.8);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
        }

        .timer {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--danger-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .score {
            font-size: 1.3rem;
            color: var(--success-color);
            font-weight: 600;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .question {
            font-size: 1.4rem;
            margin-bottom: 2rem;
            color: var(--dark-color);
            line-height: 1.7;
            font-weight: 500;
        }

        .answers {
            display: grid;
            gap: 1rem;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e1e5e9;
            padding: 18px 24px;
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .answer-btn:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
            transform: translateX(5px);
        }

        .answer-btn.correct {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--success-color);
            color: #155724;
        }

        .answer-btn.incorrect {
            background: rgba(220, 53, 69, 0.1);
            border-color: var(--danger-color);
            color: #721c24;
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .difficulty-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .difficulty-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .difficulty-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .difficulty-card h3 {
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .difficulty-card p {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .difficulty-easy { 
            border-left: 6px solid var(--success-color); 
        }
        .difficulty-easy p { color: var(--success-color); }

        .difficulty-medium { 
            border-left: 6px solid var(--warning-color); 
        }
        .difficulty-medium p { color: var(--warning-color); }

        .difficulty-hard { 
            border-left: 6px solid var(--danger-color); 
        }
        .difficulty-hard p { color: var(--danger-color); }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .ranking-table th, .ranking-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(225, 229, 233, 0.5);
        }

        .ranking-table th {
            background: rgba(102, 126, 234, 0.1);
            font-weight: 600;
            color: var(--dark-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .ranking-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .ranking-table tr:first-child td {
            background: rgba(255, 215, 0, 0.2);
            font-weight: bold;
        }

        .notification {
            background: rgba(209, 236, 241, 0.9);
            color: #0c5460;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--info-color);
            backdrop-filter: blur(10px);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(225, 229, 233, 0.5);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .admin-upload {
            background: rgba(255, 255, 255, 0.9);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            border: 3px dashed #667eea;
            text-align: center;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .admin-upload:hover {
            border-color: #5a6fd8;
            background: rgba(102, 126, 234, 0.02);
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 15px 30px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        .result-icon {
            font-size: 5rem;
            margin: 2rem 0;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .floating-download {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        .floating-download:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.6);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
            50% { box-shadow: 0 10px 25px rgba(102, 126, 234, 0.8); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
                width: 98%;
            }

            .grid-2 {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .quiz-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }

            .difficulty-selector {
                grid-template-columns: 1fr;
            }

            .floating-download {
                width: 60px;
                height: 60px;
                bottom: 20px;
                right: 20px;
                font-size: 1.5rem;
            }

            .timer {
                font-size: 1.5rem;
            }

            .question {
                font-size: 1.2rem;
            }
        }

        .version-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">LP</div>
            <h1>Quiz L√≠ngua Portuguesa</h1>
            <p>üéØ Aprenda e teste seus conhecimentos de forma divertida!</p>
        </div>

        <!-- Tela de Login -->
        <div id="loginScreen" class="screen active">
            <h2 style="text-align: center; margin-bottom: 3rem; color: #333; font-size: 2rem;">üö™ Entrar no Sistema</h2>
            
            <!-- Formul√°rio do Estudante (Centralizado) -->
            <div style="max-width: 400px; margin: 0 auto 3rem; background: rgba(255,255,255,0.9); padding: 2rem; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; margin-bottom: 1.5rem; text-align: center;">üë®‚Äçüéì Estudante</h3>
                <div class="form-group">
                    <label for="studentName">üìù Nome:</label>
                    <input type="text" id="studentName" placeholder="Digite seu nome completo">
                </div>
                <div class="form-group">
                    <label for="studentSeries">üéí S√©rie:</label>
                    <select id="studentSeries">
                        <option value="">Selecione sua s√©rie</option>
                        <option value="5ano">5¬∫ Ano - Ensino Fundamental I</option>
                        <option value="6ano">6¬∫ Ano - Ensino Fundamental II</option>
                        <option value="7ano">7¬∫ Ano - Ensino Fundamental II</option>
                        <option value="8ano">8¬∫ Ano - Ensino Fundamental II</option>
                        <option value="9ano">9¬∫ Ano - Ensino Fundamental II</option>
                    </select>
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-success" onclick="loginStudent()" style="width: 100%; font-size: 1.1rem;">Entrar como Estudante</button>
                </div>
            </div>

            <!-- Estat√≠sticas do Sistema (Vis√≠vel apenas no login) -->
            <div id="systemStatsLogin" class="stats-card" style="margin: 2rem auto; max-width: 600px; text-align: center;">
                <h4 style="color: #667eea; margin-bottom: 1rem;">üìä Estat√≠sticas do Sistema</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: #28a745;" id="totalUsersLogin">0</div>
                        <small>Usu√°rios</small>
                    </div>
                    <div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: #667eea;" id="totalQuizzesLogin">0</div>
                        <small>Quizzes</small>
                    </div>
                    <div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: #ffc107;" id="totalQuestionsLogin">0</div>
                        <small>Quest√µes</small>
                    </div>
                    <div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: #dc3545;" id="totalSubjectsLogin">0</div>
                        <small>Mat√©rias</small>
                    </div>
                </div>
                
                <!-- Bot√µes de A√ß√£o para Visitantes -->
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 1.5rem;">
                    <button class="btn btn-success" onclick="generateSampleFile()" style="font-size: 0.9rem;">üì• Baixar Exemplos</button>
                    <button class="btn btn-secondary" onclick="showDetailedStatsPublic()" style="font-size: 0.9rem;">üìà Relat√≥rio Detalhado</button>
                    <button class="btn" onclick="exportPublicData()" style="font-size: 0.9rem;">üíæ Exportar Dados</button>
                </div>
            </div>

            <!-- Formul√°rio do Admin (Mais discreto, embaixo) -->
            <div style="max-width: 350px; margin: 0 auto; background: rgba(108, 117, 125, 0.1); padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(108, 117, 125, 0.2);">
                <h3 style="color: #6c757d; margin-bottom: 1rem; text-align: center; font-size: 1rem;">üë®‚Äçüè´ Acesso Administrativo</h3>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="adminPassword" style="font-size: 0.9rem;">üîê Senha:</label>
                    <input type="password" id="adminPassword" placeholder="Senha do administrador" style="font-size: 0.9rem;">
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="loginAdmin()" style="font-size: 0.9rem;">Entrar como Admin</button>
                </div>
            </div>
        </div>

        <!-- Tela Principal do Estudante -->
        <div id="studentScreen" class="screen">
            <div class="quiz-header">
                <div>
                    <strong id="welcomeStudent" style="font-size: 1.3rem;">Bem-vindo!</strong>
                    <div class="score">üèÜ Pontos: <span id="studentScore">0</span></div>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="showRanking()">üìä Ranking</button>
                    <button class="btn btn-danger" onclick="logout()">üö™ Sair</button>
                </div>
            </div>

            <div id="newQuizNotification" class="notification" style="display: none;">
                üéâ <strong>Novos quizzes dispon√≠veis!</strong> Confira as novas quest√µes adicionadas pelo professor.
            </div>

            <div class="form-group">
                <label for="subjectSelect">üìö Selecione a Mat√©ria:</label>
                <select id="subjectSelect">
                    <option value="">Escolha uma mat√©ria</option>
                    <option value="ortografia">‚úèÔ∏è Ortografia</option>
                    <option value="morfologia">üî§ Morfologia</option>
                    <option value="redacao">üìù Reda√ß√£o</option>
                    <option value="sintaxe">üîó Sintaxe</option>
                    <option value="literatura">üìñ Literatura</option>
                    <option value="fonologia">üîä Fonologia</option>
                </select>
            </div>

            <h3 style="margin-bottom: 1.5rem; color: #333;">‚ö° Escolha o N√≠vel de Dificuldade:</h3>
            <div class="difficulty-selector">
                <div class="difficulty-card difficulty-easy" onclick="selectDifficulty('easy')">
                    <h3>üü¢ F√°cil</h3>
                    <p>30 segundos</p>
                    <small>Ideal para iniciantes</small>
                </div>
                <div class="difficulty-card difficulty-medium" onclick="selectDifficulty('medium')">
                    <h3>üü° M√©dio</h3>
                    <p>20 segundos</p>
                    <small>Desafio equilibrado</small>
                </div>
                <div class="difficulty-card difficulty-hard" onclick="selectDifficulty('hard')">
                    <h3>üî¥ Dif√≠cil</h3>
                    <p>10 segundos</p>
                    <small>Para experts</small>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn" id="startQuizBtn" onclick="startQuiz()" disabled style="font-size: 1.2rem; padding: 18px 36px;">üöÄ Iniciar Quiz</button>
            </div>
        </div>

        <!-- Tela do Quiz -->
        <div id="quizScreen" class="screen">
            <div class="quiz-header">
                <div class="timer">‚è±Ô∏è <span id="timer">30</span>s</div>
                <div class="score">üìù Quest√£o <span id="questionNumber">1</span>/10</div>
                <div class="score">üèÜ Pontos: <span id="quizScore">0</span></div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 10%"></div>
            </div>

            <div class="question-card">
                <div class="question" id="questionText">Carregando quest√£o...</div>
                <div class="answers" id="answersContainer"></div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-danger" onclick="endQuiz()">‚èπÔ∏è Finalizar Quiz</button>
                <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">üí° Use as teclas 1-5 para responder rapidamente!</p>
            </div>
        </div>

        <!-- Tela de Resultado -->
        <div id="resultScreen" class="screen">
            <div style="text-align: center;">
                <h2 style="color: #333; margin-bottom: 1rem;">üéØ Quiz Finalizado!</h2>
                <div class="result-icon" id="resultIcon">üéâ</div>
                <div style="font-size: 3rem; margin-bottom: 2rem; color: #28a745;">
                    <strong>Pontua√ß√£o: <span id="finalScore">0</span></strong>
                </div>
                <div class="stats-card">
                    <div id="resultMessage" style="font-size: 1.3rem; margin-bottom: 1rem;">
                        Parab√©ns! Continue praticando para melhorar ainda mais.
                    </div>
                    <div id="resultStats" style="color: #666;"></div>
                </div>
                <div style="margin-top: 2rem;">
                    <button class="btn btn-success" onclick="backToStudent()">üéÆ Novo Quiz</button>
                    <button class="btn btn-secondary" onclick="showRanking()">üèÜ Ver Ranking</button>
                </div>
            </div>
        </div>

        <!-- Tela de Ranking -->
        <div id="rankingScreen" class="screen">
            <h2 style="margin-bottom: 2rem; text-align: center;">üèÜ Ranking dos Estudantes</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>üèÖ Posi√ß√£o</th>
                        <th>üë§ Nome</th>
                        <th>üéì S√©rie</th>
                        <th>üèÜ Pontos</th>
                        <th>üìä Quizzes</th>
                    </tr>
                </thead>
                <tbody id="rankingBody">
                    <tr>
                        <td colspan="5" style="text-align: center; color: #666;">Nenhum dado dispon√≠vel</td>
                    </tr>
                </tbody>
            </table>
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-secondary" onclick="backToStudent()">‚Üê Voltar</button>
            </div>
        </div>

        <!-- Tela de Admin -->
        <div id="adminScreen" class="screen">
            <div class="quiz-header">
                <h2>üë®‚Äçüíº Painel Administrativo</h2>
                <button class="btn btn-danger" onclick="logout()">üö™ Sair</button>
            </div>

            <div class="admin-upload">
                <h3>üìÅ Upload de Quest√µes</h3>
                <p style="margin: 1rem 0;">Envie um arquivo <strong>JSON</strong>, <strong>CSV</strong> ou <strong>YAML</strong> com as quest√µes</p>
                <input type="file" id="fileInput" class="file-input" accept=".json,.csv,.yaml,.yml" onchange="handleFileUpload()">
                <label for="fileInput" class="file-label">üìé Escolher Arquivo</label>
                <div id="fileName" style="margin-top: 1.5rem; color: #666; font-weight: 500;"></div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>üìã Exemplo de estrutura JSON:</label>
                    <textarea readonly style="height: 250px; font-family: 'Courier New', monospace; font-size: 0.85rem; background: #f8f9fa;">{
  "materia": "ortografia",
  "serie": "6ano", 
  "questoes": [
    {
      "pergunta": "Qual a grafia correta?",
      "respostas": [
        "exce√ß√£o",    // ‚Üê CORRETA (√≠ndice 0)
        "excess√£o",   // ‚Üê incorreta
        "exse√ß√£o",    // ‚Üê incorreta
        "exces√£o",    // ‚Üê incorreta
        "exe√ß√£o",     // ‚Üê incorreta
        "ece√ß√£o"      // ‚Üê incorreta
      ],
      "correta": 0,   // ‚Üê √çNDICE da resposta correta
      "dificuldade": "medium"
    }
